<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Games</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        
        header {
            background-color: #2196F3;
            color: white;
            width: 100%;
            text-align: center;
            padding: 20px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .container {
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
        }
        
        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            grid-gap: 20px;
            margin-top: 30px;
        }
        
        .game-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
        }
        
        .game-image {
            height: 150px;
            background-color: #e0f7fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .game-image img {
            max-width: 100%;
            max-height: 100%;
        }
        
        .game-info {
            padding: 15px;
        }
        
        .game-title {
            margin: 0;
            font-size: 18px;
            color: #333;
        }
        
        .game-description {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .play-button {
            display: block;
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 10px;
            border: none;
            border-radius: 5px;
            margin-top: 10px;
            text-decoration: none;
            font-weight: bold;
        }
        
        footer {
            margin-top: auto;
            width: 100%;
            background-color: #333;
            color: white;
            text-align: center;
            padding: 10px 0;
            font-size: 14px;
        }
        
        /* Leaderboard Styles */
        .leaderboard-section {
            margin-top: 40px;
            width: 100%;
        }
        
        .leaderboard-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 20px;
        }
        
        .no-scores {
            text-align: center;
            padding: 20px;
            color: #757575;
            font-style: italic;
        }
        
        .leaderboard {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-around;
        }
        
        .game-score-card {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 15px;
            width: calc(33.333% - 20px);
            min-width: 200px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .game-score-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .game-score-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin: 0;
        }
        
        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
            margin: 10px 0;
        }
        
        .game-score-details {
            font-size: 14px;
            color: #757575;
            margin: 5px 0;
        }
        
        .game-score-controls {
            display: flex;
            justify-content: flex-end;
        }
        
        .reset-button {
            background-color: #F44336;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .reset-button:hover {
            background-color: #D32F2F;
        }
        
        .leaderboard-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        
        .filter-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-dropdown {
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: white;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .game-score-card {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>Brain Games</h1>
        <p>A collection of fun cognitive games to challenge your mind</p>
    </header>
    
    <div class="container">
        <h2>Select a Game</h2>
        
        <div class="game-grid">
            <div class="game-card">
                <div class="game-image">
                    <div style="font-size: 60px; font-weight: bold;">‚Ä¢‚Ä¢‚Ä¢</div>
                </div>
                <div class="game-info">
                    <h3 class="game-title">Dot Game</h3>
                    <p class="game-description">Test your ability to quickly recognize dot patterns. Improve your subitizing skills!</p>
                    <a href="/games/dotgame/index.html" class="play-button">Play Now</a>
                </div>
            </div>
            
            <div class="game-card">
                <div class="game-image">
                    <div style="font-size: 30px; font-weight: bold;">1+2+3=?</div>
                </div>
                <div class="game-info">
                    <h3 class="game-title">Sum Game</h3>
                    <p class="game-description">Drag across numbers to reach the target sum. Challenge your mental math skills!</p>
                    <a href="/games/sumgame/index.html" class="play-button">Play Now</a>
                </div>
            </div>
            
            <div class="game-card">
                <div class="game-image">
                    <div style="font-size: 24px; font-weight: bold;">‚ö´‚ö™‚ö´‚ö™‚ö´<br>‚ö™‚ö´‚ö™‚ö´‚ö™</div>
                </div>
                <div class="game-info">
                    <h3 class="game-title">Subtraction Cover Up</h3>
                    <p class="game-description">Use a 10-frame to practice subtraction. Click circles to turn them on or off!</p>
                    <a href="/games/subtractioncoverup/index.html" class="play-button">Play Now</a>
                </div>
            </div>
            
            <div class="game-card">
                <div class="game-image">
                    <div style="font-size: 20px; font-weight: bold; line-height: 1.2;">10<br>‚ï± ‚ï≤<br>3 + ?</div>
                </div>
                <div class="game-info">
                    <h3 class="game-title">Number Bonds</h3>
                    <p class="game-description">Practice number bonds and part-whole relationships with visual connections!</p>
                    <a href="/games/numberbonds/index.html" class="play-button">Play Now</a>
                </div>
            </div>
            
            <div class="game-card">
                <div class="game-image">
                    <div style="font-size: 16px; font-weight: bold; line-height: 1.2;">‚ö´‚ö´‚ö´‚ö´‚ö´<br>‚ö´‚ö´‚ö™‚ö™‚ö™<br><br>‚ö™‚ö™‚ö™‚ö™‚ö™<br>‚ö™‚ö™‚ö™‚ö™‚ö™</div>
                </div>
                <div class="game-info">
                    <h3 class="game-title">Bridge to 20</h3>
                    <p class="game-description">Use two 10-frames to practice addition that bridges over 10. Fill frames to show the sum!</p>
                    <a href="/games/bridgeto20/index.html" class="play-button">Play Now</a>
                </div>
            </div>
            
            <div class="game-card">
                <div class="game-image">
                    <div style="font-size: 16px; font-weight: bold; line-height: 1.2;">‚ö´‚ö´‚ö´‚ö´‚ö´<br>‚ö´‚ö´‚ö´‚ö´‚ö´<br><br>‚ö´‚ö´‚ö´‚ö™‚ö™<br>‚ö™‚ö™‚ö™‚ö™‚ö™</div>
                </div>
                <div class="game-info">
                    <h3 class="game-title">Bridge from 20</h3>
                    <p class="game-description">Practice subtraction that bridges under 10. Remove circles to show the answer!</p>
                    <a href="/games/bridgefrom20/index.html" class="play-button">Play Now</a>
                </div>
            </div>
            
            <div class="game-card">
                <div class="game-image">
                    <div style="font-size: 20px; font-weight: bold; line-height: 1.2;">üé≤üé≤<br>0‚Üí100<br>Bridge!</div>
                </div>
                <div class="game-info">
                    <h3 class="game-title">Race to 100</h3>
                    <p class="game-description">Roll dice and race to 100! Practice bridging across tens with addition and subtraction.</p>
                    <a href="/games/raceto100/index.html" class="play-button">Play Now</a>
                </div>
            </div>
            
            <div class="game-card">
                <div class="game-image">
                    <div style="font-size: 16px; font-weight: bold; line-height: 1.2;">‚ñ¨‚ñ¨ ‚Üí ‚óè‚óè‚óè‚óè‚óè<br>25 - 7 = ?<br>Regroup!</div>
                </div>
                <div class="game-info">
                    <h3 class="game-title">Regrouping Subtraction</h3>
                    <p class="game-description">Learn subtraction with regrouping! Drag ten-rods to break them into ones and practice borrowing.</p>
                    <a href="/games/regrouping/index.html" class="play-button">Play Now</a>
                </div>
            </div>
            
            <div class="game-card">
                <div class="game-image">
                    <div style="font-size: 18px; font-weight: bold; line-height: 1.2;">500<br>‚Üì üéØ<br>- 127<br>= ?</div>
                </div>
                <div class="game-info">
                    <h3 class="game-title">Subtraction Tower</h3>
                    <p class="game-description">2-player race to zero! Practice regrouping and explain your thinking to win.</p>
                    <a href="/games/subtractiontower/index.html" class="play-button">Play Now</a>
                </div>
            </div>
        </div>
        
        <div class="leaderboard-section">
            <h2>High Scores</h2>
            <div class="leaderboard-container">
                <div class="no-scores" id="no-scores-message">No high scores yet. Play some games to see your scores here!</div>
                <div class="leaderboard" id="leaderboard">
                    <!-- High scores will be dynamically added here by JavaScript -->
                </div>
                <div class="leaderboard-controls">
                    <div class="filter-controls">
                        <label for="game-filter">Game:</label>
                        <select id="game-filter" class="filter-dropdown">
                            <option value="all">All Games</option>
                            <!-- Games will be added dynamically -->
                        </select>
                        
                        <label for="config-filter" id="config-filter-label" style="display: none;">Config:</label>
                        <select id="config-filter" class="filter-dropdown" style="display: none;">
                            <option value="all">All Configurations</option>
                            <!-- Configurations will be added dynamically -->
                        </select>
                    </div>
                    <button id="reset-all-scores" class="reset-button">Reset All Scores</button>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>&copy; 2025 Brain Games - A learning project</p>
    </footer>

    <script>
        // High Score Management
        const ScoreManager = {
            // Define game IDs and their display information
            gameConfig: {
                'sumgame': {
                    name: 'Sum Game',
                    description: 'Mental Math Challenge',
                    scoreType: 'points',
                    storageKey: 'sumGameHighScores', // Note: now plural as it stores multiple scores
                    configParams: ['targetNumber', 'gridSize', 'timeLimit']
                },
                'dotgame': {
                    name: 'Dot Game',
                    description: 'Pattern Recognition',
                    scoreType: 'n/a', // Currently doesn't have a score
                    storageKey: 'dotGameHighScore'
                },
                'raceto100': {
                    name: 'Race to 100',
                    description: 'Number Line Racing',
                    scoreType: 'points',
                    storageKey: 'raceTo100HighScores',
                    configParams: ['mode', 'time']
                }
                // Add more games here as they are created
            },
            
            // Get all high scores from localStorage
            getAllScores: function() {
                const scores = {};
                
                // Get scores for each configured game
                for (const [gameId, config] of Object.entries(this.gameConfig)) {
                    if (this.usesDetailedScores(gameId)) {
                        scores[gameId] = this.getDetailedScores(gameId);
                    } else {
                        const scoreValue = localStorage.getItem(config.storageKey);
                        scores[gameId] = scoreValue ? parseInt(scoreValue) : null;
                    }
                }
                
                return scores;
            },
            
            // Check if game uses detailed score tracking
            usesDetailedScores: function(gameId) {
                const config = this.gameConfig[gameId];
                if (!config) return false;
                
                return !!config.configParams && config.configParams.length > 0;
            },
            
            // Get all detailed scores for a game
            getDetailedScores: function(gameId) {
                const config = this.gameConfig[gameId];
                if (!config) return null;
                
                const storedScores = localStorage.getItem(config.storageKey);
                console.log('Raw stored scores for', gameId, ':', storedScores);
                
                if (!storedScores) return null;
                
                try {
                    const parsed = JSON.parse(storedScores);
                    console.log('Parsed scores for', gameId, ':', parsed);
                    return parsed;
                } catch (e) {
                    console.error('Failed to parse stored scores:', e);
                    return null;
                }
            },
            
            // Generate a unique configuration key
            getConfigKey: function(gameId, configOptions) {
                const config = this.gameConfig[gameId];
                console.log('Getting config key for', gameId, 'with options:', configOptions);
                
                if (!config || !config.configParams) {
                    console.log('No config or configParams for', gameId);
                    return null;
                }
                
                console.log('Config params for', gameId, ':', config.configParams);
                
                // Create a key based on configuration parameters using a consistent format
                // e.g., "t9_g6_m2" for target 9, grid 6x6, time 2min
                const key = config.configParams
                    .map(param => {
                        const value = configOptions[param];
                        console.log('Parameter', param, 'has value', value);
                        
                        // Use shortened parameter names to make keys more readable
                        let shortParam = param;
                        if (param === 'targetNumber') shortParam = 't';
                        if (param === 'gridSize') shortParam = 'g';
                        if (param === 'timeLimit') shortParam = 'm'; // minutes
                        
                        return value !== undefined ? `${shortParam}${value}` : '';
                    })
                    .filter(Boolean)
                    .join('_');
                    
                console.log('Generated key:', key);
                return key;
            },
            
            // Get best score for a specific game configuration
            getScore: function(gameId, configOptions = {}) {
                const config = this.gameConfig[gameId];
                if (!config) return null;
                
                // For games with detailed scoring
                if (this.usesDetailedScores(gameId)) {
                    const scores = this.getDetailedScores(gameId);
                    if (!scores) return null;
                    
                    // If configuration options provided, get specific score
                    if (Object.keys(configOptions).length > 0) {
                        const configKey = this.getConfigKey(gameId, configOptions);
                        return configKey && scores[configKey] ? scores[configKey].score : null;
                    }
                    
                    // Otherwise, find the best score across all configurations
                    let bestScore = null;
                    
                    for (const scoreData of Object.values(scores)) {
                        if (bestScore === null || scoreData.score > bestScore) {
                            bestScore = scoreData.score;
                        }
                    }
                    
                    return bestScore;
                }
                
                // For games with simple scoring
                const scoreValue = localStorage.getItem(config.storageKey);
                return scoreValue ? parseInt(scoreValue) : null;
            },
            
            // Set high score for a game (if higher than current)
            setScore: function(gameId, score, configOptions = {}) {
                console.log('Setting score for', gameId, ':', score, 'with options:', configOptions);
                
                const config = this.gameConfig[gameId];
                if (!config) {
                    console.log('No config found for game ID:', gameId);
                    return false;
                }
                
                // For games with detailed scoring
                if (this.usesDetailedScores(gameId) && Object.keys(configOptions).length > 0) {
                    console.log('Game uses detailed scoring. Getting config key...');
                    const configKey = this.getConfigKey(gameId, configOptions);
                    
                    if (!configKey) {
                        console.log('Failed to generate config key');
                        return false;
                    }
                    
                    console.log('Using config key:', configKey);
                    
                    // Get existing scores or initialize new object
                    const scores = this.getDetailedScores(gameId) || {};
                    console.log('Retrieved existing scores:', scores);
                    
                    // Check if new score is better than existing score for this configuration
                    const existingData = scores[configKey];
                    console.log('Existing data for this config:', existingData);
                    
                    if (!existingData || score > existingData.score) {
                        console.log('New score is better (or first score for this config)');
                        // Store score with configuration and timestamp
                        scores[configKey] = {
                            score: score,
                            config: {...configOptions},
                            timestamp: new Date().toISOString()
                        };
                        
                        const json = JSON.stringify(scores);
                        console.log('Saving to localStorage with key', config.storageKey, 'value:', json);
                        localStorage.setItem(config.storageKey, json);
                        
                        // Verify storage worked
                        const savedItem = localStorage.getItem(config.storageKey);
                        console.log('Verification - item saved in localStorage:', savedItem);
                        return true; // Score was updated
                    }
                    
                    console.log('Score was not higher than existing score');
                    return false; // Score was not higher
                }
                
                // For games with simple scoring
                const currentScore = this.getScore(gameId);
                
                if (currentScore === null || score > currentScore) {
                    localStorage.setItem(config.storageKey, score.toString());
                    return true; // Score was updated
                }
                
                return false; // Score was not higher
            },
            
            // Reset score for a specific game
            resetScore: function(gameId, configKey = null) {
                const config = this.gameConfig[gameId];
                if (!config) return false;
                
                // For games with detailed scoring
                if (this.usesDetailedScores(gameId)) {
                    // If configKey provided, only reset that specific configuration
                    if (configKey) {
                        const scores = this.getDetailedScores(gameId);
                        if (scores && scores[configKey]) {
                            delete scores[configKey];
                            localStorage.setItem(config.storageKey, JSON.stringify(scores));
                        }
                    } else {
                        // Reset all scores for this game
                        localStorage.removeItem(config.storageKey);
                    }
                } else {
                    // For games with simple scoring
                    localStorage.removeItem(config.storageKey);
                }
                
                return true;
            },
            
            // Reset all scores
            resetAllScores: function() {
                for (const [gameId, config] of Object.entries(this.gameConfig)) {
                    localStorage.removeItem(config.storageKey);
                }
                return true;
            },
            
            // Format date string
            formatDate: function(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString();
            },
            
            // Format configuration for display
            formatConfig: function(gameId, configData) {
                const config = this.gameConfig[gameId];
                if (!config) return '';
                
                switch (gameId) {
                    case 'sumgame':
                        return `Target: ${configData.targetNumber}, Grid: ${configData.gridSize}√ó${configData.gridSize}, Time: ${configData.timeLimit}min`;
                    case 'raceto100':
                        return `Mode: ${configData.mode}, Time: ${configData.time}s`;
                    default:
                        return Object.entries(configData)
                            .map(([key, value]) => `${key}: ${value}`)
                            .join(', ');
                }
            }
        };
        
        // Function to render the leaderboard
        function renderLeaderboard(gameFilter = 'all', configFilter = 'all') {
            const leaderboardEl = document.getElementById('leaderboard');
            const noScoresMessage = document.getElementById('no-scores-message');
            const scores = ScoreManager.getAllScores();
            
            console.log('Rendering leaderboard with scores:', scores);
            console.log('Game filter:', gameFilter, 'Config filter:', configFilter);
            
            // Check if we have any scores
            let hasAnyScores = false;
            for (const gameId in scores) {
                const gameScores = scores[gameId];
                console.log('Game', gameId, 'scores:', gameScores);
                if (gameScores !== null && (typeof gameScores === 'object' ? Object.keys(gameScores).length > 0 : true)) {
                    hasAnyScores = true;
                    break;
                }
            }
            
            // Toggle visibility based on whether we have scores
            noScoresMessage.style.display = hasAnyScores ? 'none' : 'block';
            
            // Clear current leaderboard
            leaderboardEl.innerHTML = '';
            
            // If no scores, don't render anything else
            if (!hasAnyScores) return;
            
            // Create a card for each game with scores
            for (const [gameId, gameScores] of Object.entries(scores)) {
                if (gameScores === null) continue; // Skip games without scores
                
                // Apply game filter
                if (gameFilter !== 'all' && gameId !== gameFilter) continue;
                
                const gameConfig = ScoreManager.gameConfig[gameId];
                const usesDetailedScores = ScoreManager.usesDetailedScores(gameId);
                
                // Skip if we have an empty object for detailed scores
                if (usesDetailedScores && Object.keys(gameScores).length === 0) continue;
                
                if (usesDetailedScores) {
                    // For games with detailed configuration scores
                    let filteredScores = Object.entries(gameScores)
                        .map(([configKey, scoreData]) => ({
                            configKey,
                            ...scoreData
                        }));
                    
                    // Apply configuration filter if specified
                    if (configFilter !== 'all') {
                        console.log('Applying config filter:', configFilter, 'to scores:', filteredScores);
                        filteredScores = filteredScores.filter(item => {
                            // For sumgame, filter by specific configuration parameters
                            if (gameId === 'sumgame' && item.config) {
                                const [paramName, paramValue] = configFilter.split(':');
                                console.log('Checking item:', item, 'for param', paramName, '=', paramValue);
                                const itemValue = item.config[paramName];
                                const matches = itemValue == paramValue; // Use loose equality for string/number comparison
                                console.log('Match result:', matches);
                                return matches;
                            }
                            return false;
                        });
                        console.log('Filtered scores:', filteredScores);
                    }
                    
                    const topScores = filteredScores
                        .sort((a, b) => b.score - a.score) // Sort by score (highest first)
                        .slice(0, 3); // Take top 3 scores
                    
                    // Create game score card
                    const scoreCard = document.createElement('div');
                    scoreCard.className = 'game-score-card';
                    
                    // Create card header
                    const cardHeader = document.createElement('div');
                    cardHeader.className = 'game-score-header';
                    cardHeader.innerHTML = `
                        <h3 class="game-score-title">${gameConfig.name}</h3>
                    `;
                    scoreCard.appendChild(cardHeader);
                    
                    // Create card content
                    const scoresList = document.createElement('div');
                    scoresList.className = 'scores-list';
                    
                    // Add each configuration score
                    topScores.forEach(scoreData => {
                        const scoreItem = document.createElement('div');
                        scoreItem.className = 'score-item';
                        
                        scoreItem.innerHTML = `
                            <div class="score-value">${scoreData.score} ${gameConfig.scoreType}</div>
                            <div class="score-config">${ScoreManager.formatConfig(gameId, scoreData.config)}</div>
                            <div class="score-date">${ScoreManager.formatDate(scoreData.timestamp)}</div>
                            <button class="reset-button small" data-game-id="${gameId}" data-config-key="${scoreData.configKey}">√ó</button>
                        `;
                        
                        scoresList.appendChild(scoreItem);
                    });
                    
                    // Add scores list to card
                    scoreCard.appendChild(scoresList);
                    
                    // Add description and reset button
                    scoreCard.innerHTML += `
                        <div class="game-score-details">${gameConfig.description}</div>
                        <div class="game-score-controls">
                            <button class="reset-button" data-game-id="${gameId}">Reset All</button>
                        </div>
                    `;
                    
                    leaderboardEl.appendChild(scoreCard);
                } else {
                    // For games with simple scoring
                    // Create game score card
                    const scoreCard = document.createElement('div');
                    scoreCard.className = 'game-score-card';
                    
                    // Create card content
                    scoreCard.innerHTML = `
                        <div class="game-score-header">
                            <h3 class="game-score-title">${gameConfig.name}</h3>
                        </div>
                        <div class="score-value">${gameScores} ${gameConfig.scoreType}</div>
                        <div class="game-score-details">${gameConfig.description}</div>
                        <div class="game-score-controls">
                            <button class="reset-button" data-game-id="${gameId}">Reset</button>
                        </div>
                    `;
                    
                    leaderboardEl.appendChild(scoreCard);
                }
            }
            
            // Add event listeners to reset buttons
            const resetButtons = document.querySelectorAll('.game-score-card .reset-button:not(.small)');
            resetButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const gameId = this.getAttribute('data-game-id');
                    if (confirm(`Are you sure you want to reset all scores for ${ScoreManager.gameConfig[gameId].name}?`)) {
                        ScoreManager.resetScore(gameId);
                        renderLeaderboard(); // Re-render the leaderboard
                    }
                });
            });
            
            // Add event listeners to individual score reset buttons
            const smallResetButtons = document.querySelectorAll('.game-score-card .reset-button.small');
            smallResetButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const gameId = this.getAttribute('data-game-id');
                    const configKey = this.getAttribute('data-config-key');
                    ScoreManager.resetScore(gameId, configKey);
                    renderLeaderboard(); // Re-render the leaderboard
                });
            });
        }
        
        // Populate filter dropdowns
        function populateFilters() {
            const scores = ScoreManager.getAllScores();
            const gameFilter = document.getElementById('game-filter');
            const configFilter = document.getElementById('config-filter');
            const configFilterLabel = document.getElementById('config-filter-label');
            
            // Clear existing options except the first one
            while (gameFilter.options.length > 1) {
                gameFilter.remove(1);
            }
            
            // Add games with scores to the filter
            for (const [gameId, gameScores] of Object.entries(scores)) {
                if (gameScores === null || (typeof gameScores === 'object' && Object.keys(gameScores).length === 0)) continue;
                
                const option = document.createElement('option');
                option.value = gameId;
                option.textContent = ScoreManager.gameConfig[gameId].name;
                gameFilter.appendChild(option);
            }
            
            // Update configuration filter based on selected game
            function updateConfigFilter() {
                const selectedGame = gameFilter.value;
                
                // Hide config filter by default
                configFilter.style.display = 'none';
                configFilterLabel.style.display = 'none';
                
                // Clear existing options except the first one
                while (configFilter.options.length > 1) {
                    configFilter.remove(1);
                }
                
                // Only show config filter for games with detailed scores
                if (selectedGame !== 'all' && ScoreManager.usesDetailedScores(selectedGame)) {
                    const gameScores = scores[selectedGame];
                    if (!gameScores) return;
                    
                    // For sumgame, create filter options based on the configurations
                    if (selectedGame === 'sumgame') {
                        // Get unique configuration values
                        const configOptions = {
                            targetNumber: new Set(),
                            gridSize: new Set(),
                            timeLimit: new Set()
                        };
                        
                        // Collect all unique values for each configuration parameter
                        Object.values(gameScores).forEach(scoreData => {
                            if (scoreData.config) {
                                for (const [key, value] of Object.entries(scoreData.config)) {
                                    if (configOptions[key]) {
                                        configOptions[key].add(value);
                                    }
                                }
                            }
                        });
                        
                        // Add filter options for each parameter
                        for (const [param, values] of Object.entries(configOptions)) {
                            if (values.size > 0) {
                                // Add option group
                                const group = document.createElement('optgroup');
                                group.label = param === 'targetNumber' ? 'Target' : 
                                              param === 'gridSize' ? 'Grid Size' : 'Time Limit';
                                
                                // Add sorted options
                                Array.from(values).sort((a, b) => a - b).forEach(value => {
                                    const option = document.createElement('option');
                                    option.value = `${param}:${value}`;
                                    option.textContent = param === 'gridSize' ? `${value}√ó${value}` : 
                                                        param === 'timeLimit' ? `${value} min` : value;
                                    group.appendChild(option);
                                });
                                
                                configFilter.appendChild(group);
                            }
                        }
                        
                        // Show config filter if we have options
                        if (configFilter.options.length > 1) {
                            configFilter.style.display = '';
                            configFilterLabel.style.display = '';
                        }
                    }
                }
                
                // Re-render the leaderboard with the selected filters
                renderLeaderboard(selectedGame, configFilter.value);
            }
            
            // Add event listeners to filters
            gameFilter.addEventListener('change', updateConfigFilter);
            configFilter.addEventListener('change', function() {
                renderLeaderboard(gameFilter.value, configFilter.value);
            });
            
            // Initialize config filter based on current game selection
            updateConfigFilter();
        }
        
        // Initialize the leaderboard
        document.addEventListener('DOMContentLoaded', function() {
            // Add a test score if needed for debugging
            /*
            const testConfig = { targetNumber: 9, gridSize: 6, timeLimit: 2 };
            const testKey = 'targetNumber9_gridSize6_timeLimit2';
            const testScores = {};
            testScores[testKey] = {
                score: 10,
                config: testConfig,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('sumGameHighScores', JSON.stringify(testScores));
            */
            
            // Check localStorage content
            console.log('LocalStorage content for sumGameHighScores:', localStorage.getItem('sumGameHighScores'));
            
            // Render the leaderboard
            renderLeaderboard();
            
            // Populate filter dropdowns
            populateFilters();
            
            // Add event listener for the reset all scores button
            document.getElementById('reset-all-scores').addEventListener('click', function() {
                if (confirm('Are you sure you want to reset all high scores?')) {
                    ScoreManager.resetAllScores();
                    renderLeaderboard();
                    populateFilters(); // Update filters after resetting scores
                }
            });
        });
    </script>
</body>
</html>